<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Powwow to TinTin++ Script Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 140px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -70px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-cyan-400">Powwow to TinTin++ Converter</h1>
            <p class="text-gray-400 mt-2 text-lg">An enhanced tool to help migrate your MUD scripts.</p>
        </header>

        <main class="bg-gray-800 shadow-2xl rounded-xl p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Powwow Input -->
                <div>
                    <h2 class="text-2xl font-semibold mb-3 text-white">
                        <span class="text-orange-400">#</span> Powwow Script
                    </h2>
                    <textarea id="powwow-input"
                        class="w-full h-[500px] p-4 bg-gray-900 border-2 border-gray-700 rounded-lg text-gray-300 font-mono text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition duration-300"
                        placeholder="#alias mystats={score;inventory;equipment}"></textarea>
                </div>

                <!-- TinTin++ Output -->
                <div>
                    <h2 class="text-2xl font-semibold mb-3 text-white">
                        <span class="text-cyan-400">#</span> TinTin++ Output
                    </h2>
                    <textarea id="tintin-output"
                        class="w-full h-[500px] p-4 bg-gray-900 border-2 border-gray-700 rounded-lg text-gray-300 font-mono text-sm focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition duration-300"
                        readonly
                        placeholder="#ALIAS {mystats} {score;inventory;equipment}"></textarea>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-center items-center mt-6 space-x-4">
                <button id="convert-btn" class="px-8 py-3 bg-cyan-600 text-white font-bold rounded-lg hover:bg-cyan-700 focus:outline-none focus:ring-4 focus:ring-cyan-500 focus:ring-opacity-50 transition-transform transform hover:scale-105">
                    Convert Script
                </button>
                <div class="tooltip">
                     <button id="copy-btn" onclick="copyToClipboard()" class="px-6 py-3 bg-gray-600 text-white font-bold rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-500 focus:ring-opacity-50 transition-transform transform hover:scale-105">
                        Copy Output
                    </button>
                    <span id="copy-tooltip" class="tooltiptext">Copy to clipboard</span>
                </div>
            </div>
        </main>

        <!-- Conversion Reference Guide -->
        <section class="mt-12 bg-gray-800 shadow-2xl rounded-xl p-6">
            <h2 class="text-2xl font-semibold text-center mb-6 text-white">Conversion Reference Guide</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm text-left text-gray-300">
                    <thead class="text-xs text-cyan-400 uppercase bg-gray-700">
                        <tr>
                            <th scope="col" class="px-6 py-3 rounded-l-lg">Feature</th>
                            <th scope="col" class="px-6 py-3">Powwow Syntax</th>
                            <th scope="col" class="px-6 py-3">TinTin++ Syntax</th>
                            <th scope="col" class="px-6 py-3 rounded-r-lg">Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Existing rows... -->
                        <tr class="bg-gray-800 border-b border-gray-700"><th scope="row" class="px-6 py-4 font-medium text-white whitespace-nowrap">Alias</th><td class="px-6 py-4 font-mono">#alias name=command</td><td class="px-6 py-4 font-mono">#alias {name} {command}</td><td class="px-6 py-4">Parameters $0, $1... become %0, %1...</td></tr>
                        <tr class="bg-gray-800 border-b border-gray-700"><th scope="row" class="px-6 py-4 font-medium text-white whitespace-nowrap">Action</th><td class="px-6 py-4 font-mono">#action {pattern}=command</td><td class="px-6 py-4 font-mono">#action {pattern} {command}</td><td class="px-6 py-4">Wildcards $n/&n become %n. Review needed.</td></tr>
                         <tr class="bg-gray-800 border-b border-gray-700"><th scope="row" class="px-6 py-4 font-medium text-white whitespace-nowrap">Grouping</th><td class="px-6 py-4 font-mono">#action >grp ...</td><td class="px-6 py-4 font-mono">#action {...} {...} {grp}</td><td class="px-6 py-4">Assigns a definition to a group.</td></tr>
                        <tr class="bg-gray-800 border-b border-gray-700"><th scope="row" class="px-6 py-4 font-medium text-white whitespace-nowrap">Group Enable</th><td class="px-6 py-4 font-mono">#=group / #+group</td><td class="px-6 py-4 font-mono">#GROUP group ENABLE</td><td class="px-6 py-4">Enables all definitions in a group.</td></tr>
                        <tr class="bg-gray-800 border-b border-gray-700"><th scope="row" class="px-6 py-4 font-medium text-white whitespace-nowrap">Group Disable</th><td class="px-6 py-4 font-mono">#<group / #-group</td><td class="px-6 py-4 font-mono">#GROUP group DISABLE</td><td class="px-6 py-4">Disables all definitions in a group.</td></tr>
                        <tr class="bg-gray-800 border-b border-gray-700"><th scope="row" class="px-6 py-4 font-medium text-white whitespace-nowrap">Group Toggle</th><td class="px-6 py-4 font-mono">#%group</td><td class="px-6 py-4 font-mono">#comment Manual conversion</td><td class="px-6 py-4">No direct equivalent. Requires manual scripting.</td></tr>
                        <tr class="bg-gray-800 border-b border-gray-700"><th scope="row" class="px-6 py-4 font-medium text-white whitespace-nowrap">Variable</th><td class="px-6 py-4 font-mono">#var name=value</td><td class="px-6 py-4 font-mono">#variable {name} {value}</td><td class="px-6 py-4">Access with $name. Num vars @n become $var[n].</td></tr>
                        <tr class="bg-gray-800 border-b border-gray-700"><th scope="row" class="px-6 py-4 font-medium text-white whitespace-nowrap">Key Bind</th><td class="px-6 py-4 font-mono">#bind key=command</td><td class="px-6 py-4 font-mono">#key {key} {command}</td><td class="px-6 py-4">Binds a key to a command.</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

    </div>

    <script>
        const powwowInput = document.getElementById('powwow-input');
        const tintinOutput = document.getElementById('tintin-output');
        const convertBtn = document.getElementById('convert-btn');
        const copyTooltip = document.getElementById('copy-tooltip');

        function convertSyntax(str) {
            let result = str;
            result = result.replace(/(\$|\&)(\d+)/g, '%$2');
            result = result.replace(/@(\d+)/g, '$var[$1]');
            result = result.replace(/@([a-zA-Z_]\w*)/g, '$1');
            result = result.replace(/#\s*(send|exe|print)\s*\(?((?:[^()]*|\([^()]*\))*)\)?/gi, '$2').trim();
            if ((result.startsWith('{') && result.endsWith('}')) || (result.startsWith('"') && result.endsWith('"'))) {
                result = result.substring(1, result.length - 1);
            }
            return result;
        }

        function convertScript() {
            const inputScript = powwowInput.value;
            if (!inputScript) {
                tintinOutput.value = '';
                return;
            }

            const lines = inputScript.split('\n');
            const outputLines = [];

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];
                let trimmedLine = line.trim();

                if (trimmedLine === '') {
                    outputLines.push('');
                    continue;
                }
                if (trimmedLine.startsWith('//') || trimmedLine.startsWith('/*')) {
                    outputLines.push(`#comment ${trimmedLine.substring(2).trim()}`);
                    continue;
                }
                
                // Group Enable/Disable/Toggle
                const groupCmdMatch = trimmedLine.match(/^#\s*([<=>%+-])([\w_]+)\s*$/);
                if (groupCmdMatch) {
                    const [, symbol, groupName] = groupCmdMatch;
                    if (symbol === '=' || symbol === '+') {
                        outputLines.push(`#GROUP ${groupName} ENABLE`);
                    } else if (symbol === '<' || symbol === '-') {
                        outputLines.push(`#GROUP ${groupName} DISABLE`);
                    } else if (symbol === '%') {
                        outputLines.push(`#comment MANUAL CONVERSION REQUIRED for toggling group: ${groupName}`);
                    }
                    continue;
                }

                if (trimmedLine.startsWith('#')) {
                    const commandMatch = trimmedLine.match(/^#\s*(\w+)\s*(.*)/);
                    if (!commandMatch) {
                         outputLines.push(convertSyntax(trimmedLine));
                         continue;
                    }
                    
                    const command = commandMatch[1].toLowerCase();
                    let args = commandMatch[2].trim();
                    let parts;

                    // Handle definitions with groups
                    let groupName = null;
                    const labelMatch = args.match(/^([>])([\w_]+)\s+/);
                    if (labelMatch) {
                        groupName = labelMatch[2];
                        args = args.substring(labelMatch[0].length);
                    }

                    switch (command) {
                        case 'alias':
                            parts = args.split(/=(.+)/);
                            if (parts.length >= 2) {
                                let tintinCmd = `#ALIAS {${parts[0].trim()}} {${convertSyntax(parts[1])}}`;
                                if (groupName) tintinCmd += ` {${groupName}}`;
                                outputLines.push(tintinCmd);
                            } else { outputLines.push(`#comment UNCONVERTED ALIAS: ${line}`); }
                            break;
                        
                        case 'action':
                            parts = args.split(/=(.+)/);
                            if (parts.length >= 2) {
                                let tintinCmd = `#ACTION {${convertSyntax(parts[0])}} {${convertSyntax(parts[1])}}`;
                                if (groupName) tintinCmd += ` {${groupName}}`;
                                outputLines.push(tintinCmd);
                            } else { outputLines.push(`#comment UNCONVERTED ACTION: ${line}`); }
                            break;

                        case 'var':
                             parts = args.split(/=(.+)/);
                             if (parts.length >= 2) {
                                let varName = parts[0].trim().replace(/^[@$]/, '');
                                let tintinCmd = `#VARIABLE {${varName}} {${convertSyntax(parts[1])}}`;
                                if (groupName) tintinCmd += ` {${groupName}}`;
                                outputLines.push(tintinCmd);
                             } else { outputLines.push(`#comment UNCONVERTED VARIABLE: ${line}`); }
                             break;
                             
                        case 'bind':
                            parts = args.split(/=(.+)/);
                            if (parts.length >= 2) {
                                let tintinCmd = `#KEY {${parts[0].trim()}} {${convertSyntax(parts[1])}}`;
                                if (groupName) tintinCmd += ` {${groupName}}`;
                                outputLines.push(tintinCmd);
                            } else { outputLines.push(`#comment UNCONVERTED BIND: ${line}`); }
                            break;
                            
                        // ... other cases from previous version
                        case 'mark':
                             parts = args.split(/=(.+)/);
                             if (parts.length >= 2) {
                                let tintinCmd = `#HIGHLIGHT {${convertSyntax(parts[0])}} {${convertSyntax(parts[1])}}`;
                                if (groupName) tintinCmd += ` {${groupName}}`;
                                outputLines.push(tintinCmd);
                             } else { outputLines.push(`#comment UNCONVERTED MARK: ${line}`); }
                             break;
                        case 'print':
                            outputLines.push(`#SHOWME {${convertSyntax(args)}}`);
                            break;
                        case 'emulate':
                            outputLines.push(`#READ {${convertSyntax(args)}}`);
                            break;
                        case 'reset':
                            // Reset logic remains the same
                            let type = args.toLowerCase();
                            if (['alias', 'action', 'variable', 'highlight', 'ticker', 'key'].includes(type)) {
                                outputLines.push(`#UN${type} {*} #${type}`);
                            } else if (type === 'var') {
                                outputLines.push(`#UNVARIABLE {*}`);
                            } else if (type === 'all') {
                                outputLines.push(`#UNALIAS {*}`, `#UNACTION {*}`, `#UNVARIABLE {*}`, `#UNHIGHLIGHT {*}`, `#UNTICKER {*}`, `#UNKEY {*}`, `#COMMENT --- RESET ALL ---`);
                            } else { outputLines.push(`#comment UNCONVERTED RESET: ${line}`); }
                            break;
                        case 'in':
                        case 'at':
                            const tickerMatch = args.match(/(\w+)\s*\((.*?)\)\s*(.*)/);
                            if (tickerMatch) {
                                const [, label, delayStr, tickerCmd] = tickerMatch;
                                const delayMs = parseInt(delayStr, 10);
                                const delaySec = !isNaN(delayMs) ? (delayMs / 1000).toFixed(2) : 1;
                                let tintinTicker = `#TICKER {${label}} {${convertSyntax(tickerCmd)}} ${delaySec}`;
                                if(groupName) tintinTicker += ` {${groupName}}`;
                                outputLines.push(tintinTicker);
                            } else { outputLines.push(`#comment UNCONVERTED TICKER: ${line}`); }
                            break;
                        case 'if':
                             const ifMatch = trimmedLine.match(/#if\s*\((.*?)\)\s*({?.*?}?)(?:\s*#else\s*({?.*?}?))?$/i);
                             if (ifMatch) {
                                 const [, condition, trueBlock, falseBlock] = ifMatch;
                                 let tintinIf = `#IF {${convertSyntax(condition)}} {${convertSyntax(trueBlock)}}`;
                                 if (falseBlock) {
                                     tintinIf += ` {${convertSyntax(falseBlock)}}`;
                                 }
                                 outputLines.push(tintinIf, `#comment INFO: Please manually verify the logic of the converted #IF statement.`);
                             } else { outputLines.push(`#comment UNCONVERTED IF: ${line}`); }
                             break;
                        
                        default:
                            outputLines.push(`#comment UNSUPPORTED: ${line}`);
                            break;
                    }
                } else {
                    outputLines.push(convertSyntax(trimmedLine));
                }
            }

            tintinOutput.value = outputLines.join('\n');
        }

        function copyToClipboard() {
            tintinOutput.select();
            try {
                document.execCommand('copy');
                copyTooltip.textContent = 'Copied!';
            } catch (err) {
                copyTooltip.textContent = 'Failed to copy!';
                console.error('Fallback: Oops, unable to copy', err);
            }
            setTimeout(() => { copyTooltip.textContent = 'Copy to clipboard'; }, 2000);
        }

        convertBtn.addEventListener('click', convertScript);
        
        // Updated sample input with groups
        powwowInput.value = `
// Combat aliases and actions
#alias >combat ks=kill $1
#action >combat ^You parry.=say Nice parry!

// Social actions, initially disabled
#<social
#action >social ^$1 smiles at you.=smile $1

// Enable social actions
#=social

// Toggle combat group (will be commented out)
#%combat
`.trim();

    </script>
</body>
</html>
